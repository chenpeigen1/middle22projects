package objects

import "net/http"

func Handler(w http.ResponseWriter,r *http.Request){
	m:=r.Method
	if m==http.MethodGet{
		get(w,r)
		return
	}else if m==http.MethodPut{
		put(w,r)
		return
	}
	w.WriteHeader(http.StatusMethodNotAllowed)//write http error status
}

func get(w http.ResponseWriter,r *http.Request){
	object:=strings.Split(r.URL.EscapedPath(),"/")[2]
	stream,e:=getStream(object)
	if e!=nil{
		log.Println(e)
		w.WriteHeader(http.StatusNotFound)
		return
	}
	io.Copy(w,stream)
}

func put(w http.ResponseWriter,r *http.Request){
	object:=string.Split(r.URL.EscapedPath(),"/")[2]
	c,e:=storeObject(r.Body,object)
	if e!=nil{
		log.Fatal(e)
	}
	w.WriteHeader(c)
}