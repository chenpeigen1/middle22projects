基于ElasticSearch&Kibana的字幕信息查询系统 

**姓名：刘声**

**学号**：**2021104413**

1.项目介绍

该项目是基于ElasticSearch的字幕信息查询系统，并使用Kibana作为图形化展示界面，其中ElasticSearch和Kibana是在腾讯云中部署。

使用Java作为字幕文件梳理、上传及搜索展示的服务端开发语言，并借助SpringBoot和JPA-ES等框架实现便捷开发。



**2.****运行环境**

Java版本： JDK1.8

操作系统：MacOS

ElasticSearch+Kibana：（腾讯云https://cloud.tencent.com/product/es，首月免费，次月329.1元/月）

**基本信息**

| 集群名称           | ACTIVITY-1666576990                        |
| ------------------ | ------------------------------------------ |
| 集群ID             | es-36o6eczd                                |
| 集群状态           | 正常                                       |
| 健康状态           | 绿色                                       |
| Elasticsearch 版本 | 7.5.1                                      |
| 高级特性           | 白金版         |
| 地域               | 华北地区（北京）                           |
| 网络               | Default-VPC (vpc-hv7lyxmq)                 |
| 可用区部署类型     | 单可用区                                   |
| 可用区及子网       | 北京五区, Default-Subnet (subnet-gbi9ccf3) |
| 创建时间           | 2022-10-24 10:03:58                        |
| 付费类型           | 包年包月2022-11-24 10:03:58到期            |
| 可维护时间段       | 星期一到星期日02:00~06:00东八区            |

其他信息：analysis-ik   Elasticsearch IK分析插件  

**集群配置** 

![image-20221105153233030](/Users/voice/Library/Application Support/typora-user-images/image-20221105153233030.png)

| **节点类型** | **个数** | **规格**                       | **节点存储**          | **总存储量** |
| ------------ | -------- | ------------------------------ | --------------------- | ------------ |
| 数据节点     | 3        | 标准型S1 - 2核4G ES.S1.MEDIUM4 | 高性能云硬盘 20GB x 1 | 60GB         |
| Kibana节点   | 1        | 标准型S1 - 1核2G ES.S1.SMALL2  | /                     | /            |

2.1目录结构

├── pom.xml
├── src
│  ├── 刘声-2021104413.md
│  ├── dataset
│  │  ├── Season1
│  │  └── Season2
│  ├── main
│  │  ├── java
│  │  │  └── edu
│  │  │    └── ruc
│  │  │      └── liu
│  │  │        ├── Application.java
│  │  │        ├── ServletInitializer.java
│  │  │        ├── controller
│  │  │        │  └── BaseController.java
│  │  │        ├── dto
│  │  │        │  ├── Response.java
│  │  │        │  └── SubtitleEntity.java
│  │  │        ├── importData
│  │  │        │  ├── IImportService.java
│  │  │        │  └── ImportServiceImp.java
│  │  │        ├── service
│  │  │        │  ├── BaseServiceImp.java
│  │  │        │  ├── IBaseService.java
│  │  │        │  ├── ISubtitleRepository.java
│  │  │        │  └── SubtitleRepositoryImp.java
│  │  │        └── util
│  │  │          └── Util.java
│  │  └── resources
│  │    ├── application.properties
│  └── test.java.edu.ruc.liu
│            └── ApplicationTests.java





**ElasticSearch 索引mapping**

```json
{
    "mapping": {
        "dynamic_templates": [
            {
                "message_full": {
                    "match": "message_full",
                    "mapping": {
                        "fields": {
                            "keyword": {
                                "ignore_above": 2048,
                                "type": "keyword"
                            }
                        },
                        "type": "text"
                    }
                }
            },
            {
                "message": {
                    "match": "message",
                    "mapping": {
                        "type": "text"
                    }
                }
            },
            {
                "strings": {
                    "match_mapping_type": "string",
                    "mapping": {
                        "type": "keyword"
                    }
                }
            }
        ],
        "properties": {
            "_class": {
                "type": "keyword"
            },
            "chineseSub": {
                "type": "text",
                "analyzer": "ik_smart",
                "fielddata": true
            },
            "endTime": {
                "type": "long"
            },
            "englishSub": {
                "type": "text",
                "fielddata": true
            },
            "episode": {
                "type": "keyword"
            },
            "id": {
                "type": "keyword"
            },
            "season": {
                "type": "keyword"
            },
            "startTime": {
                "type": "long"
            }
        }
    }
}

```



**Kibana**

https://es-36o6eczd.kibana.tencentelasticsearch.com:5601/app/kibana#/home?_g=() //需白名单

**中文关键词词语图**
使用中文字幕作为keyword对数量前一百个词做降序排序，词的大小和数量成线性

![](/Users/voice/Library/Application Support/typora-user-images/image-20221105153649270.png)



**英文字幕词云图**

![image-20221105153659842](/Users/voice/Library/Application Support/typora-user-images/image-20221105153659842.png)



**字幕分集频度饼图**

![image-20221105153707422](/Users/voice/Library/Application Support/typora-user-images/image-20221105153707422.png)



**接口文档**

1.根据字词查询接口

curl 

--location 

--request 

GET 'localhost:8080/searchSub?word=**吉米**'

```json
{
    "code": "200",
    "message": null,
    "data": [
        {
            "id": "S01-E05-326",
            "season": "S01",
            "episode": "E05",
            "startTime": 1240910,
            "endTime": 1243850,
            "englishSub": "- Jimmy. Jimmy. - Damn it.",
            "chineseSub": "-吉米  吉米  -去死吧"
        },
        {
            "id": "S01-E05-546",
            "season": "S01",
            "episode": "E05",
            "startTime": 1813460,
            "endTime": 1815590,
            "englishSub": "Jimmy, wait. Jimmy.",
            "chineseSub": "吉米  等等  吉米"
        },
        {
            "id": "S01-E10-329",
            "season": "S01",
            "episode": "E10",
            "startTime": 1069200,
            "endTime": 1070390,
            "englishSub": "Jimmy?",
            "chineseSub": "吉米"
        }
    ]
}
```


2.根据时间戳和剧集查询接口

curl 

--request 

GET 'localhost: 8080/searchByTimeLine?time=**1240911**&episode=**E01**&season=**S01**'

```json
{
    "code": "200",
    "message": null,
    "data": [
        {
            "id": "S01-E01-335",
            "season": "S01",
            "episode": "E01",
            "startTime": 1239220,
            "endTime": 1241410,
            "englishSub": null,
            "chineseSub": "音乐剧  演员穿旱冰鞋"
        },
        {
            "id": "S01-E01-336",
            "season": "S01",
            "episode": "E01",
            "startTime": 1240410,
            "endTime": 1242290,
            "englishSub": "I'm gonna give you a 9.6 for technique,",
            "chineseSub": "我给你俩的演技打9.6分"
        }
    ]
}

```



3.字幕文件上传接口

curl 

--location 

--request 

POST 'localhost:8080/ import

```json
{
    "code": "200",
    "message": null,
    "data": null
}
```



 